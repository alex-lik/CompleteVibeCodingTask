# WebSocket Integration Guide

## –û–±–∑–æ—Ä

–°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è WebSocket —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–æ–±—ã—Ç–∏—è—Ö –∑–∞–¥–∞—á.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **–¢–∏–ø—ã** (`src/types/websocket.ts`)
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤—Å–µ —Ç–∏–ø—ã WebSocket —Å–æ–æ–±—â–µ–Ω–∏–π
   - –¢–∏–ø—ã –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - –û–ø—Ü–∏–∏ –¥–ª—è —Ö—É–∫–∞

2. **–•—É–∫** (`src/hooks/useWebSocket.ts`)
   - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
   - Ping/Pong –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π

3. **–ö–æ–Ω—Ç–µ–∫—Å—Ç** (`src/context/WebSocketContext.tsx`)
   - –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ WebSocket
   - –£–¥–æ–±–Ω—ã–µ —Ö—É–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

4. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** (`src/components/`)
   - `WebSocketConnection.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç–∞—Ç—É—Å–∞
   - `WebSocketDebug.tsx` - –ø–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```tsx
import { useWebSocketContext } from '../context/WebSocketContext';

function MyComponent() {
  const { isConnected, sendMessage, lastMessage } = useWebSocketContext();

  return (
    <div>
      <div>–°—Ç–∞—Ç—É—Å: {isConnected ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '–û—Ç–∫–ª—é—á–µ–Ω–æ'}</div>
      <button onClick={() => sendMessage({ type: 'ping' })}>
        –û—Ç–ø—Ä–∞–≤–∏—Ç—å Ping
      </button>
    </div>
  );
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ö—É–∫–æ–≤

```tsx
import {
  useLastMessageType,
  useMessageHistoryType,
  useConnectionInfo
} from '../context/WebSocketContext';
import { TaskStartedMessage } from '../types/websocket';

function TaskComponent() {
  // –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞—Ç–æ–π –∑–∞–¥–∞—á–µ
  const lastStartedTask = useLastMessageType<TaskStartedMessage>('task_started');

  // –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö
  const finishedTasks = useMessageHistoryType('task_finished');

  // –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
  const { uptime, messagesReceived } = useConnectionInfo();

  return (
    <div>
      {lastStartedTask && (
        <div>–ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–¥–∞—á–∞: {lastStartedTask.data.title}</div>
      )}
    </div>
  );
}
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI

#### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ (–∫–æ–º–ø–∞–∫—Ç–Ω—ã–π)

```tsx
import { WebSocketStatusIndicator } from '../components/WebSocketConnection';

<WebSocketStatusIndicator />
```

#### –ü–æ–ª–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```tsx
import { WebSocketConnection } from '../components/WebSocketConnection';

<WebSocketConnection
  showDetails={true}
  compact={false}
  className="my-4"
/>
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û–ø—Ü–∏–∏ WebSocket –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

```tsx
const wsOptions = {
  // URL WebSocket —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: ws://localhost:8002/ws)
  url: 'ws://localhost:8002/ws',

  // API –∫–ª—é—á (–±–µ—Ä–µ—Ç—Å—è –∏–∑ localStorage –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω)
  apiKey: 'your-api-key',

  // –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (–±–µ—Ä–µ—Ç—Å—è –∏–∑ localStorage –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ)
  projectName: 'my-project',

  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  reconnectAttempts: 5,

  // –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (–º—Å)
  reconnectInterval: 3000,

  // –ò–Ω—Ç–µ—Ä–≤–∞–ª ping —Å–æ–æ–±—â–µ–Ω–∏–π (–º—Å)
  pingInterval: 30000,

  // –í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è react-hot-toast
  enableNotifications: true,

  // –ö–æ–ª–ª–±—ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
  onConnect: () => console.log('Connected'),
  onDisconnect: () => console.log('Disconnected'),
  onError: (error) => console.error('Error:', error),
  onMessage: (message) => console.log('Message:', message),
};

<WebSocketProvider options={wsOptions}>
  <App />
</WebSocketProvider>
```

## –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã:

1. **connection** - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
2. **pong** - –æ—Ç–≤–µ—Ç –Ω–∞ ping
3. **task_started** - –∑–∞–¥–∞—á–∞ –Ω–∞—á–∞—Ç–∞
4. **task_finished** - –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
5. **task_status_updated** - —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –æ–±–Ω–æ–≤–ª–µ–Ω
6. **task_error** - –æ—à–∏–±–∫–∞ –∑–∞–¥–∞—á–∏

### –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:

```typescript
{
  type: 'task_started',
  timestamp: '2024-01-01T12:00:00Z',
  data: {
    task_id: 'task_123',
    project_name: 'my-project',
    agent_name: 'agent-1',
    title: '–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ',
    started_at: '2024-01-01T12:00:00Z'
  }
}
```

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è:

- ‚úÖ –ù–∞—á–∞–ª–æ –∑–∞–¥–∞—á–∏ (`task_started`)
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ (`task_finished`)
- üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (`task_status_updated`)
- ‚ö†Ô∏è –û—à–∏–±–∫–∏ –∑–∞–¥–∞—á (`task_error`)

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ –æ–ø—Ü–∏—é `enableNotifications: false`.

## –û—Ç–ª–∞–¥–∫–∞

### –ü–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö:

- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —Ç–∏–ø–∞–º
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å:
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –û–±—Ä—ã–≤ —Å–≤—è–∑–∏ –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- –û—à–∏–±–∫–∏
- –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- API –∫–ª—é—á –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ query –ø–∞—Ä–∞–º–µ—Ç—Ä
- –ö–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –°–æ–æ–±—â–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 100)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—Ä–µ–Ω–¥–µ—Ä—ã —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- React 18+
- TypeScript
- Tailwind CSS
- shadcn/ui
- react-hot-toast

## –¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥

### –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á –≤ localStorage
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω –Ω–∞ localhost:8002
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–ø—Ü–∏—é `enableNotifications`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ react-hot-toast –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### –ß–∞—Å—Ç—ã–µ –æ–±—Ä—ã–≤—ã:
1. –£–≤–µ–ª–∏—á—å—Ç–µ `pingInterval`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
3. –£–≤–µ–ª–∏—á—å—Ç–µ `reconnectAttempts`